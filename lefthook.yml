pre-commit:
  parallel: true
  commands:
    fmt:
      glob: "*.go"
      run: gofmt -w {staged_files} && git add {staged_files}

    vet:
      glob: "*.go"
      run: go vet ./...

    staticcheck:
      glob: "*.go"
      run: staticcheck ./...

    test:
      glob: "*.go"
      run: go test -race -coverprofile=coverage.out -covermode=atomic ./...

    mod-tidy:
      glob: "go.{mod,sum}"
      run: go mod tidy

    trailing-whitespace:
      glob: "*"
      run: |
        if grep -rIn '[[:blank:]]$' {staged_files} 2>/dev/null | grep -v "Binary file"; then
          echo "Error: Trailing whitespace found"
          exit 1
        fi
